<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>School TV Display</title>
  <style>
    :root {
      --bg: #0a1124;
      --accent: #06b6d4;
      --card-bg: rgba(255, 255, 255, 0.05);
      --text: #e6eef6;
      --muted: #94a3b8;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; font-family: "Inter", sans-serif; background: var(--bg); color: var(--text); overflow: hidden; }

    .screen { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; }

    .slides { position: absolute; inset: 0; display: flex; transition: transform 0.5s ease; }

    .slide { min-width: 100%; height: 100%; padding: 40px; display: flex; flex-direction: column; justify-content: center; align-items: center; }

    .slide-inner {
      background: var(--card-bg); padding: 30px; border-radius: 16px;
      backdrop-filter: blur(6px);
      width: 80%; max-width: 800px;
      text-align: center;
    }

    h1 { font-size: 32px; margin-bottom: 20px; color: var(--accent); }
    .card { background: var(--card-bg); padding: 10px 20px; border-radius: 10px; margin: 10px 0; }

    .footer { position: absolute; bottom: 30px; width: 100%; text-align: center; }

    .hint {
      display: inline-block; padding: 12px 24px;
      background: linear-gradient(90deg, rgba(6,182,212,0.3), rgba(124,58,237,0.3));
      border-radius: 999px; font-weight: 600;
      color: var(--accent); cursor: pointer;
      backdrop-filter: blur(8px);
    }

    .overlay {
      position: absolute; inset: 0; background: rgba(0,0,0,0.8);
      backdrop-filter: blur(8px); transform: translateY(100%);
      transition: transform 0.4s ease; padding: 20px; overflow-y: auto;
    }

    .overlay.open { transform: translateY(0); }

    .floor { margin-bottom: 30px; }
    .floor h2 { color: var(--accent); margin-bottom: 10px; }

    .rooms { display: flex; flex-wrap: wrap; gap: 10px; }

    .room { background: var(--card-bg); padding: 12px 18px; border-radius: 10px; cursor: pointer; }

    .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.7); display: none; align-items: center; justify-content: center; }
    .modal.show { display: flex; }
    .modal-content { background: #111a2b; padding: 24px; border-radius: 12px; text-align: center; }
    .modal-content button { margin-top: 10px; padding: 8px 16px; background: var(--accent); border: none; border-radius: 8px; color: white; cursor: pointer; }
  </style>
</head>
<body>
  <div class="screen">
    <div class="slides" id="slides"></div>
    <div class="footer"><div class="hint" id="hint">menyuga kirish uchun ekranga bosing</div></div>

    <div class="overlay" id="overlay">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
        <h2>üè´ –°—Ö–µ–º–∞ —à–∫–æ–ª—ã</h2>
        <button id="close" style="background:var(--accent);border:none;border-radius:8px;padding:6px 12px;color:#fff;cursor:pointer">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
      <div id="floors"></div>
    </div>

    <div class="modal" id="modal">
      <div class="modal-content" id="modal-content"></div>
    </div>
  </div>

  <script>
    const SHEET_ID = "1Z1wyUYj4l-D_egywsnPEiLU7CbXs7OFVN5qbAQ9ttzA";
    const API_KEY = "AIzaSyApl7_bMpqpB9GXrxUtVAfaTfNtrhyEcgM";
    const RANGE = "–õ–∏—Å—Ç1!A1:K100";

    async function loadData() {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`;
      const res = await fetch(url);
      const json = await res.json();
      const rows = json.values;
      const headers = rows[0];
      const items = rows.slice(1).map(r => Object.fromEntries(headers.map((h, i) => [h, r[i]])));
      return parseData(items);
    }

    function parseData(rows) {
      return {
        best_student_week: rows.find(r => r.type === "best_student_week"),
        best_class_week: rows.find(r => r.type === "best_class_week"),
        recent_events: rows.filter(r => r.type === "recent_event"),
        top_classes_quarter: rows.filter(r => r.type === "top_class_quarter"),
        floors: Object.values(rows.filter(r => r.type === "room_info").reduce((acc, r) => {
          if (!acc[r.floor]) acc[r.floor] = { floor: r.floor, rooms: [] };
          acc[r.floor].rooms.push(r);
          return acc;
        }, {}))
      };
    }

    function renderSlides(DATA){
      const slides = document.getElementById('slides');
      slides.innerHTML = '';

      slides.appendChild(makeSlide('–õ—É—á—à–∏–π —É—á–µ–Ω–∏–∫ –Ω–µ–¥–µ–ª–∏', `
        <div class="card"><b>${DATA.best_student_week.name}</b> (${DATA.best_student_week.class})<br>–ë–∞–ª–ª: ${DATA.best_student_week.score}</div>`));

      slides.appendChild(makeSlide('–õ—É—á—à–∏–π –∫–ª–∞—Å—Å –Ω–µ–¥–µ–ª–∏', `
        <div class="card"><b>${DATA.best_class_week.class}</b><br>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª: ${DATA.best_class_week.avg}</div>`));

      slides.appendChild(makeSlide('–ù–µ–¥–∞–≤–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è', 
        DATA.recent_events.map(e=>`<div class="card"><b>${e.title}</b><div>${e.date}</div></div>`).join('')
      ));

      slides.appendChild(makeSlide('–õ—É—á—à–∏–µ –∫–ª–∞—Å—Å—ã –∑–∞ –∫–≤–∞—Ä—Ç–∞–ª', 
        DATA.top_classes_quarter.map(c=>`<div class="card"><b>${c.class}</b> ‚Äî ${c.avg}</div>`).join('')
      ));
    }

    function makeSlide(title,content){
      const s=document.createElement('div');
      s.className='slide';
      s.innerHTML=`<div class="slide-inner"><h1>${title}</h1>${content}</div>`;
      return s;
    }

    function showSlide(i){
      const slides=document.querySelectorAll('.slide');
      slides.forEach((el,idx)=>{el.style.transform=`translateX(${(idx-i)*100}%)`;});
    }

    function renderFloors(DATA){
      const floors=document.getElementById('floors');
      floors.innerHTML='';
      DATA.floors.sort((a,b)=>b.floor-a.floor).forEach(f=>{
        const div=document.createElement('div');
        div.className='floor';
        div.innerHTML=`<h2>–≠—Ç–∞–∂ ${f.floor}</h2>`;
        const rooms=document.createElement('div');
        rooms.className='rooms';
        f.rooms.forEach(r=>{
          const card=document.createElement('div');
          card.className='room';
          card.textContent=`${r.room} ‚Äî ${r.class}`;
          card.onclick=()=>showModal(r);
          rooms.appendChild(card);
        });
        div.appendChild(rooms);
        floors.appendChild(div);
      });
    }

    function showModal(r){
      const modal=document.getElementById('modal');
      const cont=document.getElementById('modal-content');
      cont.innerHTML=`<h3>${r.room} ‚Äî ${r.class}</h3><p>${r.subject}</p><p>–£—á–∏—Ç–µ–ª—å: ${r.teacher}</p><button onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>`;
      modal.classList.add('show');
    }

    function closeModal(){document.getElementById('modal').classList.remove('show');}

    document.getElementById('hint').onclick=()=>document.getElementById('overlay').classList.add('open');
    document.getElementById('close').onclick=()=>document.getElementById('overlay').classList.remove('open');

    (async ()=>{
      const DATA=await loadData();
      renderSlides(DATA);
      renderFloors(DATA);
      showSlide(0);
      let i=0;setInterval(()=>{i=(i+1)%document.querySelectorAll('.slide').length;showSlide(i);},5000);
    })();
  </script>
</body>
</html>
